<!DOCTYPE html>
<!-- saved from url=(0014)about:internet -->
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">

<head>

<title>Netron for HTML5</title>
<meta http-equiv="X-UA-Compatible" content="IE=9" />
<style type="text/css">
body { background-color: #000; margin-left: 0; margin-right: 0; margin-top: 0; }
.center { margin-left: auto; margin-right: auto; width: 1024px; }
input[type="text"] { text-align: center; border: none; background: #000; color: #fff; font-family: Verdana; font-size: 10px; font-weight: bold; outline: none; }
input[type="button"] { border: 1px solid #555; background: #555; color: #000; margin-bottom: 6px; font-family: Verdana; font-size: 10px; font-weight: bold; outline: none; overflow: visible; }
input[type="button"]:hover { border: 1px solid #999; background: #999; color: #000; cursor: pointer; }
input[type="button"]:active { border: 1px solid #ccc; background: #ccc; position: relative; top: 2px; }
input[type="button"]::-moz-focus-inner { border: none; }
#canvas { border: 1px solid #222; outline: none; }
#canvas:focus { outline: 1px solid #555; }
</style>
<script src="netron.js" type="text/javascript"></script>
<script type="text/javascript">
//<![CDATA[

var graph = null;

function document_load()
{
	graph = new Graph(document.getElementById("canvas"));
 	graph.style = { background: "#000", connection: "#fff", selection: "#888", connector: "#fff", connectorBorder: "#000", connectorHoverBorder: "#000", connectorHover: "#f00" };
	var e1 = graph.addElement(personTemplate, { x:200, y:100 }, "John Smith");
	var e2 = graph.addElement(personTemplate, { x:400, y:100 }, "Emily Jones");
	var e3 = graph.addElement(personTemplate, { x:300, y:200 }, "Daniel Smith");
	var c1 = graph.addConnection(e1.getConnector("children"), e3.getConnector("father"));
	var c2 = graph.addConnection(e2.getConnector("children"), e3.getConnector("mother"));
	graph.update();
}

var personTemplate = new PersonTemplate();

function PersonTemplate()
{
	this.resizable = false;
	this.defaultWidth = 150;
	this.defaultHeight = 30;
	this.defaultContent = "";
	this.connectorTemplates = [
		{ name: "father",   type: "PersonTemplate", description: "Father",   position: function(element) { return { x: Math.floor(element.getRectangle().width / 3), y: 0 } } },
		{ name: "mother",   type: "PersonTemplate", description: "Mother",   position: function(element) { return { x: Math.floor(element.getRectangle().width * 2 / 3), y: 0 } } },
		{ name: "children", type: "PersonTemplate", description: "Children", position: function(element) { return { x: Math.floor(element.getRectangle().width / 2), y: element.getRectangle().height } } }
	];
}

PersonTemplate.prototype.paint = function(element, context)
{
	var rectangle = element.getRectangle();
	context.fillStyle = "#000";
	context.strokeStyle = element.selected ? "#888" : "#fff";
	context.lineWidth = 2;
	context.fillRect(rectangle.x, rectangle.y, rectangle.width, rectangle.height);
	context.strokeRect(rectangle.x, rectangle.y, rectangle.width, rectangle.height);
	context.font = "bold 10px Verdana";
	context.fillStyle = "#fff";
	context.textBaseline = "bottom";
	context.textAlign = "center";
	context.fillText(element.getContent(), rectangle.x + (rectangle.width / 2), rectangle.y + 20);
};

PersonTemplate.prototype.edit = function(element, point)
{
	contentEditor.start(element);
};

var contentEditor = new ContentEditor();

function ContentEditor()
{
	this.input = null;
}

ContentEditor.prototype.start = function(element)
{
	var rectangle = element.getPageRectangle();
	this.element = element;
	this.input = document.createElement('input');
	this.input.type = "text";
	this.input.style.position = "absolute";
	this.input.style.zIndex = 1;
	this.input.style.top = (rectangle.y + 8) + "px";
	this.input.style.left = (rectangle.x + 2) + "px";
	this.input.style.width = (rectangle.width - 5) + "px";
	this.input.onblur = function(e) 
	{ 
		contentEditor.cancel(); 
	}
	this.input.onkeydown = function(e) 
	{ 
		if (e.keyCode == 13) { contentEditor.commit(); } // Enter
		if (e.keyCode == 27) { contentEditor.cancel(); } // ESC
	};
	this.element.owner.canvas.parentNode.appendChild(this.input);
	this.input.value = element.getContent();
	this.input.select();
	this.input.focus();	
};

ContentEditor.prototype.commit = function()
{
	this.element.setContent(this.input.value);
	this.cancel();
}

ContentEditor.prototype.cancel = function()
{
	if (this.input !== null)
	{	
		var input = this.input;
		this.input = null;
		this.element.owner.canvas.parentNode.removeChild(input);
		this.element = null;
	}
};

//]]>
</script>

</head>

<body onload="document_load()">
<a href="../" hidefocus="true"><img src="http://www.lutzroeder.com/Back.png" hidefocus="true" border="0" style="margin:8px;"/></a>
<br/>
<div class="center" style="position: relative;">
<canvas style="position: absolute;" id="canvas" width="1024" height="768" tabindex="0"></canvas>
<input style="position: absolute; top: 5px; left: 5px; width: 85px; height: 19px;" type="button" value="Add Person" onclick="graph.createElement(personTemplate);" />

</div>
</body>

</html>
